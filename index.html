<!doctype>
<html>
  <head>
    <title>Bowling Scorecard</title>
    <link rel="stylesheet" type="text/css" href="style.css">
  </head>

  <body>

    <header>
      <h1>
        Please enter your name to start your Bowling Scorecard
      </h1>
    </header>

    <form id="enter_name_form">
      Please enter your name:<input type="text" id="enter_name">
      <input type="submit" id="name_submit" value="Enter name">
    </form>

    <form id="enter_roll_form">
      Please enter pins hit:<input type="text" id="enter_roll">
      <input type="submit" id="roll_submit" value="Enter pins">
    </form>

    <table id="frames">
    </table>

    <section>
      <h2 id="messages"></h2>
    </section>

    <script src='src/Player.js'></script>
    <script src='src/Frame.js'></script>
    <script src='src/ScoreCard.js'></script>
    <script src='http://code.jquery.com/jquery-2.1.1.min.js'></script>
    <script>
      $(document).ready(function(){

        $('#name_submit').on('click', function(event) {
          event.preventDefault();
          $('#enter_name_form').css("display", "none");
          $('#enter_roll_form').show();
          
          var name = $('#enter_name').val();
          var player = new Player(name);
          var scorecard = new ScoreCard(player);
          $('h1').html(name + "'s Bowling Scorecard")
          
          var printData = function(scorecard) {
            var data = '<tr><th>Frame</th><th>Roll</th><th>Pins</th><th>Frame score</th><th>Total score</th></tr>';
            for (var frame = 0; frame < scorecard.frames.length; frame++) {
              for (var roll = 0; roll < scorecard.frames[frame].rolls.length; roll++) {
                
                if (roll === scorecard.frames[frame].rolls.length-1) { var frameScore = scorecard.frames[frame].score
                } else { var frameScore = '' }
     
                if (frame === scorecard.frames.length-1 && roll === scorecard.frames[frame].rolls.length-1 ) { var totalScore = scorecard.totalScore()
                } else { var totalScore = '' }

                var data = data + ('<tr><td>' + (frame + 1) + '</td><td>' + (roll + 1) + '</td><td>' + (scorecard.frames[frame].rolls[roll]) + '</td><td>' + frameScore + '</td><td>' + totalScore + '</td></tr>');
              }
            }
            return data;
          }

          $('#roll_submit').on('click', function(event) {
            event.preventDefault();
            var rollEntry = parseInt($('#enter_roll').val());
            scorecard.enterRoll(rollEntry);
            var tableData = printData(scorecard);
            $('#frames').html(tableData);

            if(scorecard.isFinished() === false) {
              if(scorecard.currentFrame().rolls[0] === 10) {
                $('#messages').html('Strike!') }
              else if (scorecard.currentFrame().score === 10) {
                $('#messages').html('Spare!') }
              else { $('#messages').html('') }
            }

            if(scorecard.isFinished()) {
              $('#messages').html('<p>Game Over</p>');
              if(scorecard.gutterGame()) {
                $('<p>Gutter Game!</p>').appendTo('#messages'); }
              if(scorecard.perfectGame()) {
                $('<p>Perfect Game!</p>').appendTo('#messages'); }
            }
          })
        })
      })
    </script>

  </body>

</html>
